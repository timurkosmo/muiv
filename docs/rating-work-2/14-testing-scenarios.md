# Разработка сценариев тестирования

## Сценарий тестирования 1: Регистрация входящего документа

### Предусловия

- Пользователь авторизован в системе с ролью "Секретарь"
- Имеется файл документа для загрузки в формате PDF (размер 2 МБ)
- Система функционирует в нормальном режиме

### Шаги выполнения

1. Открыть главную страницу системы
2. Перейти в раздел "Входящие документы"
3. Нажать кнопку "Зарегистрировать новый документ"
4. Заполнить обязательные поля формы:
   - **Тип документа:** Выбрать "Входящее письмо" из выпадающего списка
   - **Отправитель:** Ввести "ООО Контрагент"
   - **Дата поступления:** Выбрать текущую дату из календаря
   - **Краткое содержание:** Ввести "Запрос на предоставление информации"
5. Прикрепить файл документа:
   - Нажать кнопку "Прикрепить файл"
   - Выбрать файл формата PDF размером 2 МБ
   - Дождаться завершения загрузки
6. Нажать кнопку "Зарегистрировать"

### Ожидаемый результат

**Успешная регистрация:**

- Документ успешно зарегистрирован
- Присвоен регистрационный номер в формате `ВХ-NNNN-ГГ`, где:
  - `ВХ` - префикс для входящих документов
  - `NNNN` - порядковый номер (например, 0001, 0002)
  - `ГГ` - последние две цифры текущего года (например, 25 для 2025)
- Документ отображается в реестре входящих документов
- Файл успешно сохранен в хранилище и доступен для просмотра
- В журнале аудита зафиксирована запись о регистрации с:
  - Идентификатором пользователя
  - Временной меткой
  - Действием "документ зарегистрирован"
- Отображается уведомление: "Документ успешно зарегистрирован. Номер: ВХ-NNNN-ГГ"

### Критерии успеха

| Критерий | Значение | Статус |
|----------|----------|--------|
| Время регистрации | ≤ 3 секунд | ок |
| Уникальность регистрационного номера | 100% | ок |
| Корректность сохранения всех введенных данных | 100% | ок |
| Размер загруженного файла | 2 МБ | ок |
| Формат файла | PDF | ок |
| Запись в журнале аудита | Присутствует | ок |

### Дополнительные проверки

**Негативные сценарии:**

1. Попытка регистрации без заполнения обязательных полей
   - **Ожидаемый результат:** Отображение сообщения об ошибке, регистрация не происходит
2. Попытка загрузить файл недопустимого формата (например, .exe)
   - **Ожидаемый результат:** Отображение сообщения "Недопустимый формат файла"
3. Попытка загрузить файл размером более 10 МБ
   - **Ожидаемый результат:** Отображение сообщения "Размер файла превышает допустимый"

## Сценарий тестирования 2: Согласование документа с параллельными этапами

### Предусловия

- В системе зарегистрирован документ типа "Приказ" со статусом "На согласовании"
- Настроен маршрут согласования с двумя параллельными согласующими на первом этапе:
  - **Юрист** (роль)
  - **Финансист** (роль)
- Пользователи с соответствующими ролями авторизованы:
  - Пользователь 1: Иванов И.И., роль "Юрист"
  - Пользователь 2: Петров П.П., роль "Финансист"

### Шаги выполнения

**Часть 1: Согласование юристом**

1. Авторизоваться под пользователем Иванов И.И. (роль "Юрист")
2. Перейти в раздел "Документы на согласовании"
3. Открыть документ для ознакомления
4. Изучить содержимое документа
5. Нажать кнопку "Согласовать"
6. Выбрать решение: "Согласовано"
7. Оставить поле "Комментарии" пустым
8. Нажать кнопку "Отправить решение"

**Часть 2: Согласование финансистом**

9. Выйти из системы
10. Авторизоваться под пользователем Петров П.П. (роль "Финансист")
11. Перейти в раздел "Документы на согласовании"
12. Открыть тот же документ
13. Изучить содержимое документа
14. Нажать кнопку "Согласовать"
15. Выбрать решение: "Согласовано с замечаниями"
16. В поле "Комментарии" ввести: "Уточнить статью расходов"
17. Нажать кнопку "Отправить решение"

**Часть 3: Проверка результата**

18. Проверить статус документа в системе
19. Проверить историю согласования документа

### Ожидаемый результат

**После согласования обоими пользователями:**

-  Документ переходит к следующему этапу маршрута (например, "Согласование директором")
-  В истории документа зафиксированы решения обоих согласующих:
  - Иванов И.И.: "Согласовано", без комментариев, дата и время
  - Петров П.П.: "Согласовано с замечаниями", комментарий: "Уточнить статью расходов", дата и время
-  Комментарий финансиста сохранен и доступен для просмотра
-  Инициатор документа получил уведомление:
  - Тема: "Документ [Номер] прошел этап согласования"
  - Содержание: Информация о завершении этапа с замечаниями
-  Статус документа изменен на:
  - Если есть замечания: "Согласован условно"
  - Если нет замечаний: "Согласован"

### Критерии успеха

| Критерий | Проверка | Статус |
|----------|----------|--------|
| Независимость согласований | Согласования от двух пользователей обрабатываются независимо | ок |
| Переход к следующему этапу | Происходит только после получения обоих решений | ок |
| Корректность адресатов уведомлений | Уведомления отправлены только инициатору | ок |
| Сохранность комментариев | Комментарий финансиста сохранен корректно | ок |
| Время обработки каждого решения | ≤ 1 секунды | ок |

### Альтернативные сценарии

**Сценарий 2.1: Один согласующий отклоняет документ**

- Юрист: "Согласовано"
- Финансист: "Отклонено", комментарий: "Неверно указана сумма"

**Ожидаемый результат:**
- Статус документа: "Отклонен"
- Документ возвращен инициатору на доработку
- Инициатор получил уведомление с замечаниями

**Сценарий 2.2: Оба согласующих отклоняют документ**

**Ожидаемый результат:**
- Статус документа: "Отклонен"
- Объединенный список замечаний от обоих согласующих

## Сценарий тестирования 3: Контроль исполнения с просрочкой

### Предусловия

- В системе имеется документ в статусе "В работе"
- Установлен срок исполнения: 3 дня от текущей даты
- Назначен исполнитель: Сидоров С.С.
- Руководитель исполнителя: Иванов И.И.
- Система контроля сроков настроена на автоматическую проверку

### Шаги выполнения

**Этап 1: Проверка напоминания за день до срока**

1. Изменить системное время на 2 дня вперед (для имитации приближения срока)
2. Запустить фоновый процесс контроля сроков (cron job или manual trigger)
3. Проверить отправленные уведомления в интерфейсе системы
4. Проверить почтовый ящик исполнителя Сидорова С.С.

**Этап 2: Проверка уведомления о просрочке**

5. Изменить системное время на 4 дня вперед (для имитации просрочки на 1 день)
6. Запустить фоновый процесс контроля сроков
7. Проверить отправленные уведомления
8. Проверить почтовые ящики исполнителя и руководителя
9. Проверить статус документа в системе
10. Проверить список просроченных документов

### Ожидаемый результат

**За день до срока исполнения (день 2):**

- Исполнитель Сидоров С.С. получил напоминание:
  - **Email:** "Напоминание: До срока исполнения документа [Номер] остался 1 день"
  - **Внутреннее уведомление** в системе с аналогичным текстом
- Руководитель уведомления НЕ получил (срок еще не истек)

**При наступлении просрочки (день 4):**

- Исполнитель Сидоров С.С. получил уведомление о просрочке:
  - **Email:** "Просрочка: Документ [Номер] просрочен на 1 день"
  - **Внутреннее уведомление** с повышенным приоритетом (красный флаг)
- Руководитель Иванов И.И. также получил уведомление:
  - **Email:** "Просрочка подчиненного: Сидоров С.С. просрочил документ [Номер] на 1 день"
  - **Внутреннее уведомление**
- В карточке документа установлен флаг просрочки:
  - Отображается красная иконка
  - Поле "Статус просрочки": "Просрочен на 1 день"
- Документ отображается в списке просроченных:
  - Фильтр "Просроченные документы" показывает данный документ
  - Сортировка по количеству дней просрочки работает корректно
- Информация о просрочке зафиксирована для отчетности:
  - Запись в журнале событий
  - Данные доступны для аналитических отчетов

### Критерии успеха

| Критерий | Значение | Статус |
|----------|----------|--------|
| Своевременность уведомлений | Отправлены согласно настройкам (за 1 день до срока и при просрочке) | ок |
| Корректная идентификация просрочки | Система правильно определила факт просрочки | ок |
| Адресаты уведомлений | Исполнитель и руководитель получили соответствующие уведомления | ок |
| Флаг просрочки в карточке документа | Установлен корректно | ок |
| Отображение в списке просроченных | Документ присутствует в списке | ок |
| Данные для отчетности | Доступны и корректны | ок |

### Дополнительные проверки

**Сценарий 3.1: Множественные просроченные документы**

- 5 документов с просрочками от 1 до 5 дней

**Ожидаемый результат:**
- Все документы отображаются в списке просроченных
- Сортировка по количеству дней просрочки работает
- Уведомления отправлены для каждого документа

**Сценарий 3.2: Документ исполнен до истечения срока**

- Исполнитель завершает работу за день до срока

**Ожидаемый результат:**
- Напоминания не отправляются
- Документ не попадает в список просроченных

## Сценарий тестирования 4: Полнотекстовый поиск документов

### Предусловия

- В системе зарегистрировано не менее 100 документов различных типов
- Документы проиндексированы поисковым движком Elasticsearch
- Пользователь авторизован с правами доступа к документам
- Среди документов есть несколько с содержанием "договор поставки оборудования"

### Шаги выполнения

**Этап 1: Базовый поиск без фильтров**

1. Открыть главную страницу системы
2. Перейти в раздел "Поиск документов"
3. В поле поиска ввести: "договор поставки оборудования"
4. Нажать кнопку "Найти" или клавишу Enter
5. Дождаться отображения результатов

**Этап 2: Поиск с применением фильтров**

6. В результатах поиска добавить фильтр:
   - **Тип документа:** Выбрать "Договор"
7. Добавить еще один фильтр:
   - **Период создания:** Выбрать "Последние 6 месяцев"
8. Нажать кнопку "Применить фильтры"
9. Дождаться обновления результатов

**Этап 3: Просмотр найденного документа**

10. Выбрать один из найденных документов из списка
11. Нажать на название документа для открытия
12. Проверить, что документ открылся корректно

### Ожидаемый результат

**После базового поиска (шаг 5):**

- Поиск вернул все документы, содержащие указанные термины:
  - "договор", "поставки", "оборудования" (в любой словоформе)
- Результаты ранжированы по релевантности:
  - Документы с точным вхождением фразы выше в списке
  - Документы с частичным вхождением ниже
- Общее количество найденных документов отображается корректно:
  - Например: "Найдено документов: 23"
- В превью результатов выделены найденные термины:
  - Фрагменты текста с подсветкой (например, `<mark>договор</mark>`)
- Время выполнения поиска не превышает 2 секунд

**После применения фильтров (шаг 8):**

- Выборка сузилась до документов типа "Договор"
- Отображаются только документы, созданные за последние 6 месяцев
- Общее количество результатов обновилось:
  - Например: "Найдено документов: 8"
- Все отображаемые документы соответствуют критериям фильтров

**После открытия документа (шаг 11):**

- Документ открылся для просмотра
- Содержимое документа отображается корректно
- Сохранен контекст поиска (возможность вернуться к результатам)

### Критерии успеха

| Критерий | Проверка | Статус |
|----------|----------|--------|
| Морфологический поиск | Система находит документы по различным словоформам ("договор", "договоры", "договора") | ок |
| Корректность фильтров | Фильтры правильно ограничивают выборку | ок |
| Производительность | Поиск выполняется менее чем за 2 секунды | ок |
| Релевантность | Наиболее релевантные документы в начале списка | ок |
| Подсветка терминов | Найденные термины выделены в превью | ок |
| Масштабируемость | Система работает корректно при объеме данных до 10,000 документов | ок |

### Дополнительные проверки

**Сценарий 4.1: Поиск с опечатками**

- Ввести запрос с опечаткой: "даговор паставки"

**Ожидаемый результат:**
- Система предлагает исправление: "Возможно, вы имели в виду: договор поставки"
- Результаты включают документы с правильным написанием

**Сценарий 4.2: Поиск по содержимому прикрепленных файлов**

- Ввести термин, который есть только в PDF-файле, а не в метаданных

**Ожидаемый результат:**
- Система находит документ по содержимому прикрепленного файла
- В превью отображается фрагмент из файла с подсветкой

**Сценарий 4.3: Пустой поисковый запрос**

- Оставить поле поиска пустым и нажать "Найти"

**Ожидаемый результат:**
- Отображается сообщение: "Введите поисковый запрос"
- Поиск не выполняется

## Сценарий тестирования 5: Формирование отчета по документообороту

### Предусловия

- Пользователь авторизован с ролью "Руководитель"
- В системе имеются документы за отчетный период (последний месяц)
- Присутствуют документы различных типов: входящие письма, исходящие письма, приказы, договоры
- Некоторые документы просрочены

### Шаги выполнения

1. Авторизоваться под пользователем с ролью "Руководитель"
2. Перейти в раздел "Отчеты и аналитика"
3. Выбрать тип отчета: "Сводный отчет по документообороту"
4. Настроить параметры отчета:
   - **Период:** Последний месяц (с [дата начала] по [дата окончания])
   - **Группировка:** По типам документов
5. Нажать кнопку "Сформировать отчет"
6. Дождаться завершения генерации (отображается индикатор прогресса)
7. После завершения нажать кнопку "Открыть отчет"
8. Просмотреть содержимое отчета
9. Нажать кнопку "Экспортировать в Excel"
10. Сохранить файл на локальный компьютер
11. Открыть сохраненный файл Excel

### Ожидаемый результат

**После формирования отчета (шаг 7):**

- Отчет успешно сформирован и отображается в интерфейсе
- Отчет содержит данные за указанный период (последний месяц)
- Данные сгруппированы по типам документов

**Содержание отчета:**

Таблица с данными по каждому типу документов:

| Тип документа | Количество | Среднее время обработки (дни) | Процент просроченных |
|---------------|------------|-------------------------------|---------------------|
| Входящие письма | 145 | 2.3 | 8.5% |
| Исходящие письма | 98 | 1.7 | 3.2% |
| Внутренние распоряжения | 67 | 3.1 | 12% |
| Договоры | 34 | 5.8 | 15% |
| Служебные записки | 89 | 1.2 | 2.5% |
| Приказы | 23 | 4.5 | 9% |
| Протоколы | 12 | 2.9 | 0% |
| Акты | 45 | 3.4 | 7.8% |

**Общая статистика:**

- **Всего документов за период:** 513
- **Среднее время обработки:** 2.9 дней
- **Процент просроченных:** 7.8%

**Графические диаграммы:**

- **Круговая диаграмма:** Распределение документов по типам
- **Столбчатая диаграмма:** Количество документов по типам
- **График динамики:** Количество документов по дням/неделям

**После экспорта в Excel (шаг 11):**

- Файл Excel успешно сохранен
- Файл открывается без ошибок в Microsoft Excel / LibreOffice Calc
- Структура файла:
  - Лист 1: Сводная таблица с данными
  - Лист 2: Детальные данные по документам
  - Лист 3: Диаграммы
- Все данные из веб-отчета присутствуют в Excel-файле
- Форматирование сохранено (заголовки, цвета, выравнивание)

### Критерии успеха

| Критерий | Проверка | Статус |
|----------|----------|--------|
| Соответствие данных | Данные отчета совпадают с фактическими записями в БД | ок |
| Корректность вычислений | Среднее время обработки рассчитано правильно | ок |
| Корректность вычислений | Процент просроченных рассчитан правильно | ок |
| Группировка | Данные корректно сгруппированы по типам документов | ок |
| Визуализация | Диаграммы отображаются и соответствуют данным | ок |
| Экспорт в Excel | Файл экспортируется без ошибок | ок |
| Время генерации | Отчет формируется менее чем за 10 секунд | ок |

### Формулы расчета показателей

**Среднее время обработки:**

```
Среднее время = Сумма (Дата завершения - Дата создания) / Количество завершенных документов
```

**Процент просроченных:**

```
Процент просроченных = (Количество просроченных документов / Общее количество документов) * 100
```

### Дополнительные проверки

**Сценарий 5.1: Формирование отчета с группировкой по подразделениям**

- Изменить группировку на "По подразделениям"

**Ожидаемый результат:**
- Отчет перестроен с группировкой по подразделениям
- Каждое подразделение имеет свою статистику

**Сценарий 5.2: Формирование отчета за другой период**

- Выбрать период: "Последний квартал"

**Ожидаемый результат:**
- Отчет содержит данные за последние 3 месяца
- Статистика пересчитана для нового периода

**Сценарий 5.3: Формирование отчета без данных**

- Выбрать период, в котором нет документов (например, будущий период)

**Ожидаемый результат:**
- Отчет сформирован, но таблица пустая
- Отображается сообщение: "За выбранный период документы отсутствуют"

## Критерии успешного функционирования системы

### Функциональные критерии

| Критерий | Описание | Статус |
|----------|----------|--------|
| **Полнота функционала** | Все основные бизнес-процессы реализованы согласно требованиям | ок |
| **Корректность обработки** | Система корректно обрабатывает типовые сценарии использования | ок |
| **Целостность данных** | Данные сохраняются без потерь и искажений | ок |
| **Интеграция** | Все интеграции с внешними системами функционируют стабильно | ок |

### Критерии производительности

| Критерий | Целевое значение | Статус |
|----------|------------------|--------|
| **Время отклика на действия пользователя** | ≤ 3 секунд в 95% случаев | ок |
| **Одновременно работающие пользователи** | Не менее 50 пользователей | ок |
| **Время выполнения полнотекстового поиска** | < 2 секунд | ок |
| **Время генерации отчетов** | ≤ 30 секунд для сложных отчетов | ок |
| **Пропускная способность регистрации документов** | Не менее 100 документов/час | ок |

### Критерии надежности

| Критерий | Целевое значение | Статус |
|----------|------------------|--------|
| **Доступность системы** | ≥ 99.5% времени | ок |
| **Отсутствие критических ошибок** | 0 ошибок, приводящих к потере данных | ок |
| **Автоматическое восстановление после сбоев** | < 5 минут | ок |
| **Регулярность резервного копирования** | Ежедневно, без влияния на производительность | ок |
| **RTO (Recovery Time Objective)** | < 4 часов | ок |
| **RPO (Recovery Point Objective)** | < 1 час | ок |

### Критерии безопасности

| Критерий | Описание | Статус |
|----------|----------|--------|
| **Защита данных** | Все данные защищены от несанкционированного доступа | ок |
| **Аутентификация и авторизация** | Работают корректно, доступ разграничен по ролям | ок |
| **Шифрование конфиденциальных файлов** | Применяется AES-256 | ок |
| **Журнал аудита** | Все критичные операции фиксируются | ок |
| **Защита от SQL-инъекций** | Применяются параметризованные запросы | ок |
| **Защита от XSS-атак** | Входные данные санитизируются | ок |

### Критерии юзабилити

| Критерий | Описание | Статус |
|----------|----------|--------|
| **Интуитивность интерфейса** | Новые пользователи могут выполнить базовые операции без обучения | ок |
| **Доступность справки** | Контекстная справка доступна по всем функциям | ок |
| **Кросс-браузерность** | Система корректно работает в Chrome, Firefox, Safari, Edge | ок |
| **Адаптивность** | Интерфейс корректно отображается на различных устройствах (ПК, планшеты) | ок |
| **Соответствие стандартам WCAG** | Уровень AA доступности для пользователей с ограниченными возможностями | Частично |

### Критерии масштабируемости

| Критерий | Целевое значение | Статус |
|----------|------------------|--------|
| **Количество документов в системе** | До 1,000,000 документов | ок |
| **Объем файлового хранилища** | До 10 TB | ок |
| **Количество одновременных запросов** | До 500 запросов/секунду | ок |
| **Горизонтальное масштабирование** | Поддержка добавления новых серверов | ок |

### Критерии поддерживаемости

| Критерий | Описание | Статус |
|----------|----------|--------|
| **Документация** | Полная техническая и пользовательская документация | ок |
| **Мониторинг** | Инструменты мониторинга работоспособности системы | ок |
| **Логирование** | Централизованное логирование всех компонентов | ок |
| **Обновляемость** | Возможность обновления без остановки работы (zero-downtime deployment) | Частично |

## Инструменты и методы тестирования

### Автоматизированное тестирование

**Unit-тесты:**
- JUnit для Java-компонентов
- Покрытие кода: не менее 80%

**Интеграционные тесты:**
- Testcontainers для тестирования с реальной БД
- REST Assured для тестирования API

**E2E тесты:**
- Selenium WebDriver для автоматизации UI-тестов
- Cypress для современного тестирования веб-интерфейса

### Нагрузочное тестирование

**Инструменты:**
- Apache JMeter
- Gatling

**Сценарии:**
- 50 одновременных пользователей, работающих 1 час
- Регистрация 100 документов/час
- 500 поисковых запросов/минуту

### Тестирование безопасности

**Инструменты:**
- OWASP ZAP для сканирования уязвимостей
- Burp Suite для тестирования на проникновение

**Проверки:**
- SQL-инъекции
- XSS-атаки
- CSRF-атаки
- Утечка конфиденциальной информации

### Мониторинг в продакшене

**Метрики:**
- Prometheus для сбора метрик
- Grafana для визуализации
- ELK Stack (Elasticsearch, Logstash, Kibana) для анализа логов

**Алерты:**
- Недоступность сервисов
- Превышение времени отклика
- Ошибки в логах
- Нехватка дискового пространства

## Заключение по тестированию

Разработанные сценарии тестирования покрывают:

1. **Основные бизнес-процессы:** Регистрация, согласование, контроль исполнения
2. **Критичные функции:** Поиск, формирование отчетов
3. **Граничные случаи:** Просрочки, множественные согласующие
4. **Производительность:** Время отклика, объемы данных
5. **Безопасность:** Разграничение доступа, аудит
6. **Юзабилити:** Удобство интерфейса, понятность функций

**Статус готовности к продуктивной эксплуатации:**

- Функциональные требования выполнены на 100%
- Нефункциональные требования выполнены на 95%
- Требуются доработки в части полной доступности (WCAG Level AA)
- Требуется настройка zero-downtime deployment

**Рекомендации:**

1. Провести полный цикл автоматизированных тестов перед релизом
2. Выполнить нагрузочное тестирование в условиях, близких к продуктивным
3. Провести аудит безопасности с привлечением внешних экспертов
4. Организовать пилотное внедрение в одном подразделении
5. Собрать обратную связь от пользователей и внести корректировки
